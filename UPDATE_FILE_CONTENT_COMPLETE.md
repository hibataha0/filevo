# ๐ ุชุญุฏูุซ ูุญุชูู ุงูููู - ุฏููู ุดุงูู

## โ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุญุฏูุซ ุฏุงูุฉ `updateFileContent` ูุฏุนู ูุถุนูู ูุชุญุฏูุซ ูุญุชูู ุงูููู:
1. **ูุถุน ุงูุงุณุชุจุฏุงู (Replace Mode)**: ุงุณุชุจุฏุงู ุงูููู ุงููุฏูู ุจููุณ ุงูุงุณู ูุงููุณุงุฑ
2. **ูุถุน ุงููุณุฎุฉ ุงูุฌุฏูุฏุฉ (New Version Mode)**: ุฅูุดุงุก ููู ุฌุฏูุฏ ูุน ุชุญุฏูุซ ุงูุงุณู ูุงููุณุงุฑ

## ๐ง ุงูููุฒุงุช

### 1. ุงุณุชุจุฏุงู ุชููุงุฆู ูููููุงุช ุงููุตูุฉ
- ุงููููุงุช ุงููุตูุฉ (`.txt`, `.md`, `.json`, `.xml`, `.csv` ูุบูุฑูุง) ูุชู ุงุณุชุจุฏุงููุง ุชููุงุฆูุงู
- ูุง ุญุงุฌุฉ ูุฅุฑุณุงู `replaceMode` ูููููุงุช ุงููุตูุฉ
- ุงูุญูุงุธ ุนูู ููุณ ุงูุงุณู ูุงููุณุงุฑ

### 2. ุฎูุงุฑ ูููููุงุช ุงูุฃุฎุฑู
- ูููู ุฅุฑุณุงู `replaceMode` ูู body ูููููุงุช ุบูุฑ ุงููุตูุฉ
- `replaceMode = true`: ุงุณุชุจุฏุงู ุงูููู ุงููุฏูู ุจููุณ ุงูุงุณู ูุงููุณุงุฑ
- `replaceMode = false` ุฃู ุบูุฑ ููุฌูุฏ: ุฅูุดุงุก ูุณุฎุฉ ุฌุฏูุฏุฉ ูุน ุงุณู ููุณุงุฑ ุฌุฏูุฏ

### 3. ุชุญุฏูุซ ุชููุงุฆู ููู Category
- ูุชู ุชุญุฏูุซ `category` ุจูุงุกู ุนูู ููุน ุงูููู ุงูุฌุฏูุฏ
- ุงุณุชุฎุฏุงู `getCategoryByExtension` ูุชุญุฏูุฏ ุงูุชุตููู ุงูุตุญูุญ

### 4. ุฅุนุงุฏุฉ ูุนุงูุฌุฉ ุงูููู
- ุฅุนุงุฏุฉ ุชุนููู ุญุงูุฉ ุงููุนุงูุฌุฉ (`isProcessed = false`)
- ูุนุงูุฌุฉ ุงูููู ูู ุงูุฎูููุฉ (ุงุณุชุฎุฑุงุฌ ูุตุ ุชูููุฏ embeddingุ ุชูุฎูุต)

### 5. ุชุญุฏูุซ ุญุฌู ุงููุฌูุฏ
- ุชุญุฏูุซ ุชููุงุฆู ูุญุฌู ุงููุฌูุฏ ุฅุฐุง ูุงู ุงูููู ุฏุงุฎู ูุฌูุฏ

### 6. ุชุณุฌูู ุงููุดุงุท
- ุชุณุฌูู ุชูุงุตูู ุงูุชุญุฏูุซ ูู ุณุฌู ุงููุดุงุทุงุช

## ๐ API Usage

### 1. ููู ูุตู (ุงุณุชุจุฏุงู ุชููุงุฆู):

```http
PUT /api/files/:id/content
Content-Type: multipart/form-data
Authorization: Bearer <token>

file: <new_file.txt>
```

**ุงููุชูุฌุฉ:**
- ูุชู ุงุณุชุจุฏุงู ุงูููู ุงููุฏูู ุจููุณ ุงูุงุณู ูุงููุณุงุฑ
- ูุง ุญุงุฌุฉ ูุฅุฑุณุงู `replaceMode`

### 2. ููู ุขุฎุฑ (ุงุณุชุจุฏุงู):

```http
PUT /api/files/:id/content
Content-Type: multipart/form-data
Authorization: Bearer <token>

file: <new_file.jpg>
replaceMode: true
```

**ุงููุชูุฌุฉ:**
- ูุชู ุงุณุชุจุฏุงู ุงูููู ุงููุฏูู ุจููุณ ุงูุงุณู ูุงููุณุงุฑ
- ุงูุญูุงุธ ุนูู ููุณ ุงูุงุณู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### 3. ููู ุขุฎุฑ (ูุณุฎุฉ ุฌุฏูุฏุฉ):

```http
PUT /api/files/:id/content
Content-Type: multipart/form-data
Authorization: Bearer <token>

file: <new_file.jpg>
replaceMode: false
```

**ุงููุชูุฌุฉ:**
- ูุชู ุญุฐู ุงูููู ุงููุฏูู
- ุงูููู ุงูุฌุฏูุฏ ูุจูู ูู ููุงูู ุงูุฌุฏูุฏ
- ุชุญุฏูุซ ุงูุงุณู ูุงููุณุงุฑ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐ Integration

### ุงูุฎุทูุฉ 1: ุฅุถุงูุฉ Route

ูู ููู `routes/fileRoutes.js` ุฃู `routes/fileRoutes.js`:

```javascript
const express = require('express');
const router = express.Router();
const { protect } = require('../middleware/authMiddleware');
const fileController = require('../controllers/fileController');
const { uploadSingle } = require('../config/multerConfig');

// โ Route ูุชุญุฏูุซ ูุญุชูู ุงูููู (ูุฌุจ ูุถุนู ูุจู route /files/:id ุงูุนุงู)
router.put('/files/:id/content', protect, uploadSingle, fileController.updateFileContent);

module.exports = router;
```

**ููุงุญุธุฉ ูููุฉ:** ูุฌุจ ุฃู ูููู ูุฐุง route ูุจู ุฃู route ุฏููุงูููู ุขุฎุฑ ูุซู:
- `router.get('/files/:id', ...)`
- `router.delete('/files/:id', ...)`

### ุงูุฎุทูุฉ 2: ุฅุถุงูุฉ ุงูููุฏ ุฅูู Controller

ุงูุณุฎ ุฏุงูุฉ `updateFileContent` ูู `backend_file_controller_updateFileContent.js` ุฅูู ููู `fileController.js` ูู ุงูุจุงู ุฅูุฏ.

### ุงูุฎุทูุฉ 3: ุงุณุชูุฑุงุฏ ุงูุฏูุงู ุงููุณุงุนุฏุฉ

ุฅุฐุง ูุงูุช ุงูุฏูุงู ุงููุณุงุนุฏุฉ ููุฌูุฏุฉ ูู ูููุงุช ุฃุฎุฑูุ ุงุณุชูุฑุฏูุง:

```javascript
// ูู ุฃุนูู ููู fileController.js
const { getCategoryByExtension } = require('../utils/fileUtils');
const { logActivity } = require('./activityLogService');
const { processFile } = require('../services/fileProcessingService');
```

ุฅุฐุง ูู ุชูู ููุฌูุฏุฉุ ุงูููุฏ ูุญุชูู ุนูู ูุณุฎ ุจุณูุทุฉ ูููุง ูููู ุงุณุชุฎุฏุงููุง.

## โ๏ธ ููุงุญุธุงุช ูููุฉ

### 1. ุงูุฏูุงู ุงููุณุงุนุฏุฉ
ุงูููุฏ ูุญุชูู ุนูู ูุณุฎ ุจุณูุทุฉ ูู ุงูุฏูุงู ุงููุณุงุนุฏุฉ:
- `getCategoryByExtension`: ุชุญุฏูุฏ ุงูุชุตููู ุจูุงุกู ุนูู extension ู mimeType
- `updateFolderSize`: ุชุญุฏูุซ ุญุฌู ุงููุฌูุฏ
- `calculateFolderSizeRecursive`: ุญุณุงุจ ุญุฌู ุงููุฌูุฏ ุจุดูู recursive
- `logActivity`: ุชุณุฌูู ุงููุดุงุท
- `processFile`: ูุนุงูุฌุฉ ุงูููู ูู ุงูุฎูููุฉ

**ุฅุฐุง ูุงูุช ูุฐู ุงูุฏูุงู ููุฌูุฏุฉ ูู ูููุงุช ุฃุฎุฑูุ ุงุณุชูุฑุฏูุง ุจุฏูุงู ูู ุงุณุชุฎุฏุงู ุงููุณุฎ ุงูุจุณูุทุฉ.**

### 2. ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- ูู ุญุงูุฉ ุงูุฎุทุฃุ ูุชู ุญุฐู ุงูููู ุงูุฌุฏูุฏ ุชููุงุฆูุงู
- ูู ูุถุน replaceุ ูุชู ุญุฐู ุงูููู ุงูููุณูุฎ ุฃูุถุงู ูู ุญุงูุฉ ุงูุฎุทุฃ

### 3. ุงูุฃูุงู
- ุงูุชุญูู ูู ุฃู ุงููุณุชุฎุฏู ูููู ุงูููู ูุจู ุงูุชุญุฏูุซ
- ุงูุชุญูู ูู ูุฌูุฏ ููู ูู ุงูุทูุจ
- ูุนุงูุฌุฉ ุขููุฉ ููุฃุฎุทุงุก

## ๐ Response Format

### ูุฌุงุญ (200):
```json
{
  "success": true,
  "message": "ุชู ุงุณุชุจุฏุงู ุงูููู ุจูุฌุงุญ (ููุณ ุงูุงุณู ูุงููุณุงุฑ)" | "ุชู ุชุญุฏูุซ ุงูููู ุจูุฌุงุญ (ูุณุฎุฉ ุฌุฏูุฏุฉ)",
  "file": {
    "_id": "...",
    "name": "...",
    "path": "...",
    "size": 12345,
    "type": "...",
    "category": "...",
    ...
  },
  "replaceMode": true | false
}
```

### ุฎุทุฃ (404):
```json
{
  "success": false,
  "message": "File not found"
}
```

### ุฎุทุฃ (400):
```json
{
  "success": false,
  "message": "No file uploaded"
}
```

### ุฎุทุฃ (500):
```json
{
  "success": false,
  "message": "Error updating file content",
  "error": "Error message details"
}
```

## โ ุงูููุงุฆุฏ

1. **ูุฑููุฉ**: ุฏุนู ูุถุนูู ูุฎุชูููู ูุชุญุฏูุซ ุงูููู
2. **ุณูููุฉ ุงูุงุณุชุฎุฏุงู**: ุงุณุชุจุฏุงู ุชููุงุฆู ูููููุงุช ุงููุตูุฉ
3. **ุงูุฃูุงู**: ูุนุงูุฌุฉ ุขููุฉ ููุฃุฎุทุงุก ูุชูุธูู ุงููููุงุช ุงููุคูุชุฉ
4. **ุงูุชูุงูู**: ุชุญุฏูุซ ุชููุงุฆู ูุญุฌู ุงููุฌูุฏ ูุชุณุฌูู ุงููุดุงุท
5. **ุงููุนุงูุฌุฉ**: ุฅุนุงุฏุฉ ูุนุงูุฌุฉ ุงูููู ุชููุงุฆูุงู ุจุนุฏ ุงูุชุญุฏูุซ

## ๐ ุงูุชุญุฏูุซุงุช ุงููุณุชูุจููุฉ

- ุฅุถุงูุฉ ุฏุนู ููู versioning (ุงูุงุญุชูุงุธ ุจูุณุฎ ูุฏููุฉ)
- ุฅุถุงูุฉ ุฏุนู ููู rollback (ุงูุชุฑุงุฌุน ุนู ุงูุชุญุฏูุซ)
- ุฅุถุงูุฉ ุฏุนู ููู diff (ููุงุฑูุฉ ุงููููุงุช)




